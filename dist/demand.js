/**! Qoopido.demand 3.5.7 (MIT OR GPL-3.0+) | https://github.com/dlueth/qoopido.demand | (c) 2016 Dirk Lueth */
!function(e,t,n){"use strict";function r(e,t){return typeof e===t}function i(e){return r(e,T)&&isFinite(e)&&Math.floor(e)===e&&e>=0}function o(e){return"[object Array]"===se.call(e)}function u(e){return e&&r(e,D)}function a(e,t){return e instanceof t}function c(){return+new Date}function s(e,t){var n=e.match(be);return(n&&n[3]||y.handler)+"!"+he(e,t)}function f(e,t,n){for(var r,i=Object.keys(e),o=0;(r=i[o])!==q&&t.call(n,r,e[r])!==k;o++);}function l(e){r(console,P)||console.error(e.toString())}function d(e,t,n,r){return{__proto__:R,value:e,enumerable:!!r,configurable:!!n,writable:!!t}}function p(e,t,n){this.message=e,t&&(this.module=t),n&&(this.stack=ue.call(n))}function h(e){var t;me.test(e.path)||f(y.pattern,function(n,r){r.matches(e.path)&&(!t||t.weight<r.weight)&&(t=r)}),e.url=t?pe(t.process(e.path)):e.path,ke.emit(z,e.type,e),new qe(e.url).then(function(t,n){e.handler.validate(n)?(e.source=t,ke.emit(K,e.type,e)):e.deferred.reject(new p(ne+" (content-type)",e.path))},function(t){e.deferred.reject(new p(ne+(t?" (status)":""),e.path))})}function v(e,t){provide(e,function(){return t})}var g,m,y={cache:{},timeout:8e3,pattern:{},modules:{},handler:"module"},x="demand",w="provide",b="path",j="/"+x+"/",E=j+"handler/",S=j+"function/",O=j+"validator/",R=null,q=void 0,k=!1,M=!0,P="undefined",I="string",C="boolean",D="object",A="function",T="number",$=function(){},_="pre",H="post",L="Configure",U=_+L,N=H+L,X="cache",F=X+"Miss",B=X+"Hit",G=X+"Clear",J=X+"Exceed",Q="Request",z=_+Q,K=H+Q,V="Process",W=_+V,Y=H+V,Z="queue",ee=Z+"Enqueue",te=Z+"Dequeue",ne="error loading",re="error providing",ie="unspecified anonymous provide",oe=Array.prototype,ue=oe.slice,ae=oe.concat,ce=Object.prototype,se=ce.toString,fe=(Object.create,Object.defineProperty,Object.getOwnPropertyNames,Object.getOwnPropertyDescriptor,Function.prototype,e.setTimeout),le=e.clearTimeout,de=function(){var e=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;return function(t){return t.replace(e,"\\$&")}}(),pe=function(){var e=t.createElement("a");return function(t){return e.href=t,e.href}}(),he=function(){var e=/^\//;return function(t,n){var r=t.replace(be,"");return e.test(r)||me.test(r)||(r="/"+pe((n&&pe(n+"/../")||"/")+r).replace(xe,"")),r}}(),ve=function(){var n,r,i="setImmediate"in e;return"MutationObserver"in e?function(e){n=t.createElement("div"),new MutationObserver(function(){e()}).observe(n,{attributes:M}),n.setAttribute("i","1")}:!i&&"postMessage"in e&&!("importScripts"in e)&&"addEventListener"in e?function(){function t(t){t.source===e&&t.data&&n[t.data]&&(n[t.data](),delete n[t.data])}var n={};return e.addEventListener("message",t,k),function(t){var r=je.generate();n[r]=t,e.postMessage(r,"*")}}():!i&&"onreadystatechange"in(n=t.createElement("script"))?function(e){n.onreadystatechange=function(){n.onreadystatechange=R,n.parentNode.removeChild(n),e()},t.body.appendChild(n)}:(r=i?setImmediate:fe,function(e){r(e)})}(),ge=function(){function e(e,t){var n,r=this[e];t!==q&&(u(t)?(n=u(r),r=t.length!==q?n&&r.length!==q?r:[]:n&&r.length===q?r:{},this[e]=ge(r,t)):this[e]=t)}return function(){for(var t,n=arguments[0],r=1;(t=arguments[r])!==q;r++)f(t,e,n);return n}}(),me=/^(http(s?):)?\/\//i,ye=/\/\/#\s+sourceMappingURL\s*=\s*(?!(?:http[s]?:)?\/\/)(.+?)\.map/g,xe=new RegExp("^"+de(pe("/"))),we=new RegExp("^"+x+"|"+w+"|"+b+"$"),be=/^(mock:)?([+-])?((?:[-\w]+\/?)+)?(?:@(\d+\.\d+.\d+))?(?:#(\d+))?!/,je=function(){function e(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}function t(){}var n=Object.defineProperty,i=new RegExp("[xy]","g"),o={};return t.prototype={generate:function(){var t;do t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(i,e);while(o[t]);return o[t]=1,t},set:function(e){return r(e.uuid,P)&&n(e,"uuid",new d(this.generate())),e.uuid}},new t}();p.prototype={toString:function(){var e=this,t=x+": "+e.message+" "+(e.module?'"'+e.module+'"':"");return e.stack&&(t=p.traverse(e.stack,t,1)),t}},p.traverse=function(e,t,n){for(var r,i=new Array(n+1).join(" "),o=0;r=e[o];o++)t+="\n"+i+"> "+r.message+" "+(r.module?'"'+r.module+'"':""),r.stack&&(t=p.traverse(r.stack,t,n+1));return t};var Ee=function(){function e(e,n){var r=this;r.weight=e.length,r.url=pe(n).replace(t,"$1"),r.matchPattern=new RegExp("^"+de(e)),r.matchUrl=new RegExp("^"+de(n))}var t=/(.+)\/$/;return e.prototype={matches:function(e){return this.matchPattern.test(e)},remove:function(e){return e.replace(this.matchUrl,"")},process:function(e){return e.replace(this.matchPattern,this.url)}},e}(),Se=function(){function e(){s[this.uuid].handle(a,arguments)}function t(){s[this.uuid].handle(c,arguments)}function n(e,t){var n,r,i=this,o=s[i.uuid];for(i.state===u&&(i.state=e,i.value=t);n=o[i.state].shift();)r=n.handler.apply(R,i.value),r&&"function"==typeof r.then?r.then(n.deferred.resolve,n.deferred.reject):n.deferred[i.state===a?"resolve":"reject"].apply(R,i.value);o[a].length=0,o[c].length=0}function r(e,t,n){e.then(function(){n.resolved[t]=ue.call(arguments),n.count++,i(n)},function(){n.rejected.push(ue.call(arguments)),i(n)})}function i(e){e.count===e.total?e.deferred.resolve.apply(R,ae.apply([],e.resolved)):e.rejected.length+e.count===e.total&&e.deferred.reject.apply(R,ae.apply([],e.rejected))}function o(r){var i=this;s[je.set(i)]={handle:n.bind(i),resolved:[],rejected:[]},r(e.bind(i),t.bind(i))}var u="pending",a="resolved",c="rejected",s={};return o.prototype={state:u,catch:function(e){return this.then($,e)},always:function(e){return this.then(e,e)},then:function(e,t){var n=this,r=s[n.uuid],i=o.defer();return e&&r[a].push({handler:e,deferred:i}),t&&r[c].push({handler:t,deferred:i}),n.state!==u&&ve(r.handle),i.pledge},isPending:function(){return this.state===u},isResolved:function(){return this.state===a},isRejected:function(){return this.state===c}},o.defer=function(){var e={};return e.pledge=new o(function(t,n){e.resolve=t,e.reject=n}),e},o.all=function(e){for(var t,n=o.defer(),i=s[je.generate()]={deferred:n,resolved:[],rejected:[],total:e.length,count:0},u=0;t=e[u];u++)r(t,u,i);return n.pledge},o.race=function(e){for(var t,n=o.defer(),r=0;t=e[r];r++)t.then(n.resolve,n.reject);return n.pledge},o}(),Oe=function(){function e(){t[je.set(this)]=[]}var t={};return e.prototype={enqueue:function(){t[this.uuid]=t[this.uuid].concat(ue.call(arguments)),ke.emit(ee,this.uuid)},dequeue:function(){return ke.emit(te,this.uuid),t[this.uuid].shift()},get current(){return t[this.uuid][0]},get length(){return t[this.uuid].length}},e}(),Re=function(){function e(){var e=this;t[je.set(e)]={}}var t={};return e.prototype={get:function(e){return e?t[this.uuid][e]:t[this.uuid]},set:function(e,n){t[this.uuid][e]=n}},e}(),qe=function(t){function n(){this.readyState<4&&this.abort()}var r="XDomainRequest"in e&&e.XDomainRequest||t;return function(e){var i,o=n.bind(this),u=Se.defer(),a=xe.test(e)?new t:new r,c=y.timeout;return a.ontimeout=a.onerror=a.onabort=function(){u.reject(a.status)},a.onprogress=a.onreadystatechange=function(){le(i),i=fe(o,y.timeout)},a.onload=function(){c=le(c),"status"in a&&200!==a.status?u.reject(a.status):u.resolve(a.responseText,a.getResponseHeader&&a.getResponseHeader("content-type"))},a.open("GET",e,!0),fe(function(){a.send()}),i=fe(o,y.timeout),u.pledge}}(XMLHttpRequest),ke=function(){function e(){}var t=/^cache(Miss|Hit|Clear|Exceed)|queue(En|De)queue|(pre|post)(Configure|Request|Process|Cache)$/,n={};return e.prototype={emit:function(e,t){var r,i,o,u=n[e];if(u)for(r=ue.call(arguments,2),i=0;o=u[i];i++)o.filter&&o.filter!==t||o.callback.apply(R,r)},on:function(e,i){var o;if(r(e,I)&&r(i,A))for(e=e.split(" ");o=e.shift();)o=o.split(":"),t.test(o[0])&&(n[o[0]]||(n[o[0]]=[])).push({callback:i,filter:o[1]})}},new e}(),Me=e.demand=function(){function t(){for(var t,n=ue.call(arguments),r=this!==e?this:R,i=0;t=n[i];i++)n[i]=Ce.resolve(t,r).pledge;return Se.all(n)}return t.configure=function(e){var n,o=e.cache,a=e.version,c=e.timeout,s=e.lifetime,l=e.base,d=e.pattern,p=e.modules,h=y.modules;return r(o,C)?y.cache[""]={weight:0,state:o}:u(o)&&f(o,function(e,t){y.cache[e]={weight:e.length,state:t}}),r(a,I)&&(y.version=a),i(c)&&(y.timeout=1e3*Math.min(Math.max(c,2),12)),i(s)&&s>0&&(y.lifetime=1e3*s),r(l,I)&&""!==l&&(y.pattern.base=new Ee("",l)),u(d)&&f(d,function(e,t){"base"!==e&&(y.pattern[e]=new Ee(e,t))}),u(p)&&f(p,function(e,t){n=h[e]=h[e]||{},ke.emit(U,e,n),ge(n,t),ke.emit(N,e,n)}),t},t.on=function(e,n){return ke.on(e,n),t},t.on(F,function(e){ve(function(){new h(e)})}).on(B+" "+K,function(e){ve(function(){ke.emit(W,R,e)})}).on(W,function(e){ve(function(){g.enqueue(e)})}),t}();e.provide=function(){var e,t,n=r(arguments[0],I)?arguments[0]:R,i=o(arguments[n?1:0])?arguments[n?1:0]:R,u=i?arguments[n?2:1]:arguments[n?1:0];if(!n&&m.current&&(e=m.current,n=m.current.uri,m.process()),!n)throw new p(ie);e=e||new Ce(n),t=r(u,A),i?Me.apply(e.path,i).then(function(){e.deferred.resolve(t?u.apply(R,arguments):u)},function(){l(new p(re,e.path))}):e.deferred.resolve(t?u():u)};var Pe=function(t){function n(e){var t;return e.cache!==R?e.cache:(f(y.cache,function(n,r){0===e.path.indexOf(n)&&(!t||r.weight>t.weight)&&(t=r)}),t?t.state:k)}function r(e,t){ke.emit(e,t.path,t)}function i(){}var o,u="["+x+"]",a="[state]",l="[value]",d=new RegExp("^"+de(u)+"\\[(.+?)\\]"+de(a)+"$"),p=function(){try{return"localStorage"in e&&e.localStorage}catch(e){return k}}(),h=p&&"remainingSpace"in localStorage;return Me.on(Y,function(e){ve(function(){o.set(e)})}).on(F,function(e){Me.clear.path(e.id)}),Me.clear={path:function(){return p?function e(e){ve(function(){var t=s(e),n=u+"["+t+"]";localStorage.removeItem(n+a),localStorage.removeItem(n+l),ke.emit(G,e)})}:$}(),all:function(){return p?function(){var e;f(localStorage,function(t){e=t.match(d),e&&this.path(e[1])},this)}:$}(),expired:function(){return p?function(){var e,n;f(localStorage,function(r){e=r.match(d),e&&(n=t.parse(localStorage.getItem(u+"["+e[1]+"]"+a)),n&&n.expires>0&&n.expires<=c()&&this.path(e[1]))},this)}:$}()},i.prototype={get:function(){return p?function(e){var i,o;n(e)?(i=u+"["+e.id+"]",o=t.parse(localStorage.getItem(i+a)),o&&o.version===e.version&&(!o.expires&&!e.lifetime||o.expires>c())?(e.source=localStorage.getItem(i+l),r(B,e)):r(F,e)):r(F,e)}:function(e){r(F,e)}}(),set:function(){return p?function(e){n(e)&&ve(function(){var n,r=u+"["+e.id+"]";try{if(n=h?localStorage.remainingSpace:R,localStorage.setItem(r+l,e.source),localStorage.setItem(r+a,t.stringify({version:e.version,expires:e.lifetime?c()+e.lifetime:e.lifetime})),n!==R&&localStorage.remainingSpace===n)throw new Error("QUOTA_EXCEEDED_ERR");return M}catch(t){ke.emit(J,e.path,e)}})}:$}()},o=new i}(JSON),Ie=function(){function e(e){var n=this,r=t[je.set(n)]={queue:e,current:R};Me.on(ee+":"+e.uuid,function(){!r.current&&n.process()})}var t={};return e.prototype={process:function(){var e,n=t[je.set(this)];n.queue.length?(e=n.current=n.queue.dequeue(),e.handler.process(e.path,e.source),ke.emit(Y,e.path,e)):n.current=R},get current(){return t[je.set(this)].current}},e}(),Ce=function(){function e(e,n){var r=this,o=e.match(be);return r.deferred=Se.defer(),r.pledge=r.deferred.pledge,r.path=he(e,n),r.mock=o&&o[1]?M:k,r.cache=o&&o[2]?"+"===o[2]:R,r.type=o&&o[3]||y.handler,r.version=o&&o[4]||y.version,r.lifetime=o&&o[5]&&1e3*o[5]||y.lifetime,r.id=r.type+"!"+r.path,r.uri=(r.mock?"mock:":"")+r.type+"@"+r.version+(i(r.lifetime)&&r.lifetime>0?"#"+r.lifetime:"")+"!"+r.path,t.set(r.id,r),r}var t=new Re;return Me.list={all:function(){return Object.keys(t.get())},pending:function(){var e=[];return f(t.get(),function(t,n){n.pledge.isPending()&&e.push(t)}),e},resolved:function(){var e=[];return f(t.get(),function(t,n){n.pledge.isResolved()&&e.push(t)}),e},rejected:function(){var e=[];return f(t.get(),function(t,n){n.pledge.isRejected()&&e.push(t)}),e}},e.resolve=function(n,r){var i=t.get(s(n,r));if(!i)if(i=new e(n,r),r&&we.test(n))switch(n){case x:i.deferred.resolve(function(){var e=Me.bind(r);return f(Me,function(t,n){e[t]=n}),e}());break;case w:i.deferred.resolve(provide.bind(r));break;case b:i.deferred.resolve(r)}else Me(E+i.type).then(function(e){i.handler=e,Pe.get(i)},function(){i.deferred.reject(new p(ne+" (handler)",self.path))});return i},e}(),De=function(){var e=t.getElementsByTagName("head")[0],n=t.createElement("a"),r=/^(application|text)\/(x-)?javascript/;return Me.on(z+":module",function(e){var t=e.url;e.url=".js"!==t.slice(-3)?t+".js":t}).on(K+":module",function(e){for(var t,r;t=ye.exec(e.source);)me.test(t[1])?(n.href=self.url,r=n.protocol+"//"+n.host+t[1]):r=pe(self.url+"/../"+t[1]),e.source=e.source.replace(t[0],"//# sourceMappingURL="+r+".map")}),{validate:function(e){return r.test(e)},process:function(n,r){var i;i=t.createElement("script"),i.async=!0,i.text=r,i.setAttribute("demand-path",n),e.appendChild(i)}}}();g=new Oe,m=new Ie(g),v(E+"module",De),v(O+"isTypeOf",r),v(O+"isArray",o),v(O+"isObject",u),v(O+"isInstanceOf",a),v(S+"merge",ge),v(S+"iterate",f),v(S+"defer",ve),v(j+"uuid",je),v(j+"pledge",Se),v(j+"queue",Oe),v(j+"xhr",qe),v(j+"failure",p),Me.configure({cache:M,base:"/",pattern:{"/demand":pe((n&&n.url||location.href)+"/../").slice(0,-1)}}),n&&n.settings&&Me.configure(n.settings),ve(function(){n&&n.main&&Me(n.main)})}(this,document,"demand"in this&&demand);
//# sourceMappingURL=demand.js.map
