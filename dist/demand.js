/*! Qoopido.demand 1.0.4 | https://github.com/dlueth/qoopido.demand | (c) 2015 Dirk Lueth */
!function(e,t,r,n,a,o,u,i,c,s){"use strict";function l(){var e=this||{},t=j(e,P)?e:ce,r=J.call(arguments);return r.forEach(h,t),q.all(r)}function p(){var e,t,r=E(arguments[0],re)?arguments[0]:ce,n=r?arguments[1]:arguments[0];if(!r&&U.current&&(e=U.current,r=e.type+"!"+e.path),r)return o(function(){var a,o,i,c=D.path(r),s=ye[c.type]||(ye[c.type]={});e||!s[c.path]?(a=new P(r,n,t),o=ye[a.type][a.path]=a.pledge,e&&(e.timeout=u(e.timeout),i=e.defered,o.then(i.resolve,function(){i.reject(new S("unable to resolve module",r,arguments))}),!e.cached&&e.store(),U.length>0&&U.next())):v("duplicate found for module "+c.path)}),{when:function(){t=arguments}};throw new S("unspecified anonymous provide")}function f(e){var t,r=e.cache,n=e.debug,a=e.version,o=e.timeout,u=e.lifetime,i=e.base,c=e.pattern,s=e.probes;if(N=E(r,ne)?r:N,B=E(n,ne)?n:B,G=E(a,re)?a:G,k(o)&&(C=1e3*Math.min(Math.max(o,2),10),F=Math.min(Math.max(C/5,1e3),5e3)),k(u)&&(H=1e3*u),E(i,re)&&(L=we.base=new M("",D.url(i))),I(c))for(t in c)"base"!==t&&(we[t]=new M(t,c[t]));if(I(s))for(t in s)be[t]=s[t];return!0}function h(e,t,r){var n=this,a=D.path(e,n),o=a.type,u=a.path,i=ye[o]||(ye[o]={});r[t]=i[u]||(i[u]=new O(e,n).pledge)}function d(e,t){p(e,function(){return t})}function m(){return+new Date}function g(e){K.href=e;var t=K.search,r="demand[timestamp]="+m();return K.search+=t&&"?"!==t?"&"+r:"?"+r,K.href}function v(e){var t=j(e,S)?"error":"warn";E(console,te)||!B&&"warn"===t||console[t](e.toString())}function y(e,t){return new RegExp(e,t)}function w(e){return e.replace(he,"\\$&")}function b(e){return e.replace(me,"")}function x(e){return pe.test(e)}function j(e,t){return e instanceof t}function E(e,t){return typeof e===t}function I(e){return e&&E(e,"object")}function k(e){return E(e,"number")&&isFinite(e)&&Math.floor(e)===e&&e>=0}function q(e){function t(){n(oe,arguments)}function r(){n(ue,arguments)}function n(e,t){a.state===ae&&(a.state=e,a.value=t,o[e].forEach(function(e){e.apply(ce,a.value)}))}var a=this,o={resolved:[],rejected:[]};a.then=function(e,t){if(a.state===ae)e&&o[oe].push(e),t&&o[ue].push(t);else switch(a.state){case oe:e.apply(ce,a.value);break;case ue:t.apply(ce,a.value)}},e(t,r)}function S(e,t,r){var n=this;n.message=e,t&&(n.module=t),r&&(n.stack=J.call(r))}function M(e,t){var r=this;r.weight=e.length,r.url=D.url(t),r.regexPattern=y("^"+w(e)),r.regexUrl=y("^"+w(t))}function T(){var e=this;e.current=ce,e.queue=[]}function O(e,t){var r,n=this,a=q.defer();D.path.call(n,e,t),n.defered=a,n.pledge=a.pledge,t||n.pledge.then(ce,v),l(_+n.type).then(function(e){n.retrieve(),n.handler=e,n.cached?U.add(n):(r=R.test(n.url)?new se:new le,r.onprogress=function(){},r.ontimeout=r.onerror=r.onabort=function(){a.reject(new S("unable to load module",n.path))},r.onload=function(){n.timeout=u(n.timeout),n.source=r.responseText,U.add(n)},r.open("GET",g(e.prepare(n.url)),!0),r.send(),n.timeout=o(function(){r.readyState<4&&r.abort()},C))},a.reject)}function P(e,t,r){var n=this,a=q.defer();D.path.call(n,e),(n.pledge=a.pledge).then(ce,function(){v(new S("unable to resolve module",n.path,arguments))}),r&&r.length>0?l.apply(n,r).then(function(){a.resolve(t.apply(ce,arguments))},function(){a.reject(new S("unable to resolve dependencies for",n.path,arguments))}):a.resolve(t())}var R,A,U,D,X,$,L,N,B,C,F,G,H,J=Array.prototype.slice,Q=Array.prototype.concat,z=t.getElementsByTagName("head")[0],K=t.createElement("a"),V="demand",W="["+V+"]",Y="[state]",Z="[value]",_="/"+V+"/handler/",ee="/validator/",te="undefined",re="string",ne="boolean",ae="pending",oe="resolved",ue="rejected",ie="js",ce=null,se=a,le="XDomainRequest"in e&&e.XDomainRequest||se,pe=/^\//i,fe=/^([-\w]+\/?)+!/,he=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,de=/\/\/#\s+sourceMappingURL\s*=\s*(.+?)\.map/g,me=/^http(s?):/,ge=r&&"remainingSpace"in r,ve={cache:!0,debug:!1,version:"1.0.0",lifetime:0,timeout:5,base:"/"},ye={},we={},be={};D={url:function(e){return K.href=e,K.href},path:function(e,t){var r,n,a=this,o=e.match(fe)||ie,u=j(a,O);E(o,re)||(e=e.replace(y("^"+w(o[0])),""),o=o[1]),x(e)||(e="/"+D.url((t&&t.path&&D.url(t.path+"/../")||"/")+e).replace(R,""));for(r in we)we[r].matches(e)&&(!n||n.weight<we[r].weight)&&(n=we[r]);return u||j(a,P)?(a.type=o,a.path=e,u&&(a.url=b(D.url(n.process(e)))),void 0):{type:o,path:e}}},X={get:function(e,t){var a,o;if(r&&N){if(a=W+"["+e+"]",o=n.parse(r.getItem(a+Y)),o&&o.version===G&&o.url===t&&(0===o.expires||o.expires>m))return r.getItem(a+Z);X.clear(e)}},set:function(e,t,a){var o,u;if(r&&N){o=W+"["+e+"]";try{if(u=ge?r.remainingSpace:ce,r.setItem(o+Z,t),r.setItem(o+Y,n.stringify({version:G,expires:H>0?m+H:0,url:a})),u!==ce&&r.remainingSpace===u)throw"QuotaExceedError"}catch(i){v("unable to cache module "+e)}}},clear:function(e){var t,a,o,u;if(r)switch(typeof e){case re:t=W+"["+e+"]",r.removeItem(t+Y),r.removeItem(t+Z);break;case ne:if(e)for(a in r)o=a.match(A),o&&(u=n.parse(r.getItem(W+"["+o[1]+"]"+Y)),u&&u.expires>0&&u.expires<=m&&X.clear(o[1]));break;case te:for(a in r)0===a.indexOf(W)&&r.removeItem(a)}}},$={prepare:function(e){return e+".js"},resolve:function(e,r){var n=t.createElement("script");n.defer=n.async=!0,n.text=r,n.setAttribute("demand-path",e),z.appendChild(n)},modify:function(e,t){for(var r,n;r=de.exec(t);)n=b(D.url(e+"/../"+r[1])),t=t.replace(r[0],"//# sourcemap="+n+".map");return t}},q.prototype={constructor:q,state:ae,value:ce,listener:ce,then:ce},q.defer=function(){var e={};return e.pledge=new q(function(t,r){e.resolve=t,e.reject=r}),e},q.all=function(e){var t=q.defer(),r=t.pledge,n=[],a=[],o=e.length,u=0;return e.forEach(function(e,r){e.then(function(){n[r]=J.call(arguments),u++,u===o&&t.resolve.apply(ce,Q.apply([],n))},function(){a.push(J.call(arguments)),a.length+u===o&&t.reject.apply(ce,Q.apply([],a))})}),r},q.race=function(e){var t=q.defer();return e.forEach(function(e){e.then(t.resolve,t.reject)}),t.pledge},S.prototype={message:ce,module:ce,stack:ce,toString:function(){var e=this,t=W+" "+e.message+" "+e.module;return e.stack&&(t=S.traverse(e.stack,t,1)),t}},S.traverse=function(e,t,r){var n=new Array(r+1).join(" ");return e.forEach(function(e){t+="\n"+n+"> "+e.message+" "+e.module,e.stack&&(t=S.traverse(e.stack,t,r+1))}),t},M.prototype={weight:0,url:ce,regexPattern:ce,regexUrl:ce,matches:function(e){return this.regexPattern.test(e)},remove:function(e){return e.replace(this.regexUrl,"")},process:function(e){var t=this;return e.replace(t.regexPattern,t.url)}},T.prototype={current:ce,queue:ce,length:0,add:function(e){var t=this,r=t.queue;r.push(e),t.length++,1===r.length&&t.next()},next:function(){var e,t,r,n=this,a=n.current,u=n.queue;a&&(n.current=ce,u.shift(),n.length--),u.length&&(a=n.current=n.queue[0],e=a.defered,t=a.path,r=a.handler,!a.cached&&r.modify&&(a.source=r.modify(a.url,a.source)),r.resolve(t,a.source),be[t]&&a.probe(),a.timeout=o(function(){e.reject(new S("timeout resolving module",t))},F))}},O.prototype={type:ce,handler:ce,path:ce,url:ce,defered:ce,pledge:ce,cached:ce,source:ce,timeout:ce,probe:function(){var e,t=this,r=t.path,n=t.pledge.state===ae;n&&((e=be[r]())?p(function(){return e}):o(t.probe,100))},store:function(){var e=this;X.set(e.path,e.source,e.url)},retrieve:function(){var e=this,t=X.get(e.path,e.url),r=e.cached=!!t;r&&(e.source=t)}},P.prototype={type:ce,path:ce,pledge:ce},R=y("^"+w(D.url("/"))),A=y("^"+w(W+"[(.+?)]"+Y+"$")),U=new T,X.clear(!0),we["/"+V]=new M("/"+V,D.url(i+"/../").slice(0,-1)),f(ve)&&s&&f(s),l.configure=f,l.clear=X.clear,e.demand=l,e.provide=p,d("/"+V,l),d("/provide",p),d("/pledge",q),d("/resolve/url",D.url),d(ee+"isObject",I),d(ee+"isTypeOf",E),d(ee+"isInstanceOf",j),d(ee+"isPositiveInteger",k),d(_+ie,$),c&&o(function(){l(c)})}(this,document,localStorage,JSON,XMLHttpRequest,setTimeout,clearTimeout,demand.url,demand.main,demand.settings);
//# sourceMappingURL=demand.js.map