/*! Qoopido.demand 3.5.7 | https://github.com/dlueth/qoopido.demand | (c) 2016 Dirk Lueth */
!function(e,t,n,r,i,o,c,u){"use strict";function a(e){var t,n,r,i=xe[e];if(i)for(t=B.call(arguments,1),n=0;r=i[n];n++)r.apply(ce,t)}function s(e){w(console,"undefined")||console.error(e.toString())}function f(){for(var e,t,n,r=[],i=0;e=arguments[i];i++)n=e.match(se),e=e.replace(se,""),t=(ge[e]||(ge[e]=S.defer())).pledge,arguments[i]=(n?"mock:"+n.slice(1).join(""):"mock:")+"!"+e,r.push(t);return O.apply(ce,arguments),S.all(r)}function l(e){return e.replace(fe,"\\$&")}function h(e,t){return new RegExp(e,t)}function d(){return+new Date}function p(e){return ve.href=e,ve.href}function v(e,t){var n,r,i;if(w(e,re)){if(n=m(e,t),new E(e,t),t&&de.test(e)){switch(e){case J:n=Z+n,r=function(){var e=O.bind(t);return P(O,function(t,n){e[t]=n}),e};break;case Q:n=Z+n,r=function(){return C.bind(t)};break;case z:n=ee+t,r=function(){return t}}!me[n]&&C(n,r)}return(me[n]||(me[n]=new D(n,g(e,t)))).pledge}return j(e,S)?e:(i=S.defer(),i.resolve(e),i.pledge)}function m(e,t){return e=e.replace(se,""),ue.test(e)||ae.test(e)||(e="/"+p((t&&p(t+"/../")||"/")+e).replace(M,"")),e}function g(e,t){var n,r=e.match(se),i=pe.pattern;return e=m(e,t),ae.test(e)||P(i,function(t,r){r.matches(e)&&(!n||n.weight<r.weight)&&(n=r)}),{path:e,mock:!(!r||!r[1]),cache:r&&r[2]?"+"===r[2]:ce,handler:r&&r[3]||pe.handler,version:r&&r[4]||pe.version,lifetime:r&&r[5]&&1e3*r[5]||pe.lifetime,url:n?p(n.process(e)):e}}function x(e,t){var n,r=this[e];t!==u&&(b(t)?(n=b(r),r=t.length!==u?n&&r.length!==u?r:[]:n&&r.length===u?r:{},this[e]=k(r,t)):this[e]=t)}function y(e){return"[object Array]"===G.call(e)}function b(e){return e&&w(e,"object")}function w(e,t){return typeof e===t}function j(e,t){return e instanceof t}function R(e){return w(e,"number")&&isFinite(e)&&Math.floor(e)===e&&e>=0}function k(){for(var e,t=arguments[0],n=1;(e=arguments[n])!==u;n++)P(e,x,t);return t}function P(e,t,n){for(var r,i=Object.keys(e),o=0;(r=i[o])!==u&&t.call(n,r,e[r])!==!1;o++);}function q(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}function E(e,t){var n=this,r=e.match(se);e=m(e,t),n.path=e,n.mock=!(!r||!r[1]),n.cache=r&&r[2]?"+"===r[2]:ce,n.handler=r&&r[3]||pe.handler,n.version=r&&r[4]||pe.version,n.lifetime=r&&r[5]&&1e3*r[5]||pe.lifetime}function O(){var e,t=B.call(arguments),n=this!==window?this:ce,r=0;for(a("preResolve",t,n);e=t[r];r++)t[r]=v(e,n);return a("postResolve",t,n),S.all(t)}function C(){var e,t,n,r=arguments,i=w(r[0],re)?r[0]:ce,o=y(r[i?1:0])?r[i?1:0]:ce,c=o?r[i?2:1]:r[i?1:0];if(!i&&U.current&&(i=U.current.path,U.process()),!i)throw new H("unspecified anonymous provide");i=m(i,this),e=me[i]||(me[i]=S.defer()),t=e.pledge,n=w(c,oe),t.isPending()&&(o?O.apply(i,o).then(function(){e.resolve(n?c.apply(ce,arguments):c)},function(){s(new H("error providing",i))}):e.resolve(n?c():c))}var M,T,S,I,A,$,_,D,H,L,U,X,N,B=i.slice,F=i.concat,G=o.toString,J="demand",Q="provide",z="path",K="/"+J+"/",V=K+"storage/",W=K+"handler/",Y=K+"plugin/",Z=K+"local",ee=K+"paths",te=K+"function/",ne=K+"validator/",re="string",ie="boolean",oe="function",ce=null,ue=/^\//,ae=/^(http(s?):)?\/\//i,se=/^(mock:)?([+-])?((?:[-\w]+\/?)+)?(?:@(\d+\.\d+.\d+))?(?:#(\d+))?!/,fe=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,le=/\/\/#\s+sourceMappingURL\s*=\s*(?!(?:http[s]?:)?\/\/)(.+?)\.map/g,he=/^cache(Miss|Hit|Clear|Exceed)|(pre|post)(Configure.*|Resolve|Request|Process|Cache)$/,de=new RegExp("^"+J+"|"+Q+"|"+z+"$"),pe={cache:{},timeout:8e3,pattern:{},modules:{},handler:"module"},ve=t.createElement("a"),me={},ge={},xe={};N=function(){var n,r,i="setImmediate"in e;return"MutationObserver"in e?function(e){n=t.createElement("div"),new MutationObserver(function(){e()}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:!i&&"postMessage"in e&&!("importScripts"in e)&&"addEventListener"in e?function(){function t(t){t.source===e&&t.data&&n[t.data]&&(n[t.data](),delete n[t.data])}var n={};return e.addEventListener("message",t,!1),function(t){var r=T.generate();n[r]=t,e.postMessage(r,"*")}}():!i&&"onreadystatechange"in(n=t.createElement("script"))?function(e){n.onreadystatechange=function(){n.onreadystatechange=ce,n.parentNode.removeChild(n),e()},t.body.appendChild(n)}:(r=i?setImmediate:c,function(e){r(e)})}(),E.prototype={},T=function(){function e(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}function t(){}var n=Object.defineProperty,r=new RegExp("[xy]","g"),i={};return t.prototype={generate:function(){var t;do t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(r,e);while(i[t]);return i[t]=1,t},set:function(e){return"undefined"==typeof e.uuid&&n(e,"uuid",{__proto__:ce,value:this.generate(),enumerable:!1,configurable:!1,writable:!1}),e.uuid}},new t}(),S=function(){function e(){f[this.uuid].handle(u,arguments)}function t(){f[this.uuid].handle(a,arguments)}function n(e,t){var n,r,i=this,o=f[i.uuid];for(i.state===c&&(i.state=e,i.value=t);n=o[i.state].shift();)r=n.handler.apply(ce,i.value),r&&"function"==typeof r.then?r.then(n.deferred.resolve,n.deferred.reject):n.deferred[i.state===u?"resolve":"reject"].apply(ce,i.value);o[u].length=0,o[a].length=0}function r(e,t,n){e.then(function(){n.resolved[t]=B.call(arguments),n.count++,i(n)},function(){n.rejected.push(B.call(arguments)),i(n)})}function i(e){e.count===e.total?e.deferred.resolve.apply(ce,F.apply([],e.resolved)):e.rejected.length+e.count===e.total&&e.deferred.reject.apply(ce,F.apply([],e.rejected))}function o(r){var i=this;f[T.set(i)]={handle:n.bind(i),resolved:[],rejected:[]},r(e.bind(i),t.bind(i))}var c="pending",u="resolved",a="rejected",s=function(){},f={};return o.prototype={state:c,catch:function(e){return this.then(s,e)},always:function(e){return this.then(e,e)},then:function(e,t){var n=this,r=f[n.uuid],i=o.defer();return e&&r[u].push({handler:e,deferred:i}),t&&r[a].push({handler:t,deferred:i}),n.state!==c&&N(r.handle),i.pledge},isPending:function(){return this.state===c},isResolved:function(){return this.state===u},isRejected:function(){return this.state===a}},o.defer=function(){var e={};return e.pledge=new o(function(t,n){e.resolve=t,e.reject=n}),e},o.all=function(e){for(var t,n=o.defer(),i=f[T.generate()]={deferred:n,resolved:[],rejected:[],total:e.length,count:0},c=0;t=e[c];c++)r(t,c,i);return n.pledge},o.race=function(e){for(var t,n=o.defer(),r=0;t=e[r];r++)t.then(n.resolve,n.reject);return n.pledge},o}(),I=function(){function e(){T.set(this),t[this.uuid]=[]}var t={};return e.prototype={enqueue:function(){t[this.uuid]=t[this.uuid].concat(B.call(arguments))},dequeue:function(){return t[this.uuid].shift()},get current(){return t[this.uuid][0]},get length(){return t[this.uuid].length}},e}(),A=function(){function e(e){T.set(this),t[this.uuid]={queue:e,current:ce}}var t={};return e.prototype={process:function(){var e,n=t[this.uuid],r=n.queue;r.length?(e=n.current=r.dequeue(),e.handler.process.call(e),a("postProcess",e)):n.current=ce},get current(){return t[this.uuid].current}},e}(),$=function(){function e(e,n){var r=this;r.weight=e.length,r.url=p(n).replace(t,"$1"),r.matchPattern=h("^"+l(e)),r.matchUrl=h("^"+l(n))}var t=/(.+)\/$/;return e.prototype={matches:function(e){return this.matchPattern.test(e)},remove:function(e){return e.replace(this.matchUrl,"")},process:function(e){return e.replace(this.matchPattern,this.url)}},e}(),_=function(t){function n(){this.readyState<4&&this.abort()}var r="XDomainRequest"in e&&e.XDomainRequest||t;return function(e){var i,o=n.bind(this),u=S.defer(),a=M.test(e)?new t:new r,s=pe.timeout;return a.ontimeout=a.onerror=a.onabort=function(){u.reject(a.status)},a.onprogress=a.onreadystatechange=function(){clearTimeout(i),i=c(o,pe.timeout)},a.onload=function(){s=clearTimeout(s),"status"in a&&200!==a.status?u.reject(a.status):u.resolve(a.responseText,a.getResponseHeader&&a.getResponseHeader("content-type"))},a.open("GET",e,!0),c(function(){a.send()}),i=c(o,pe.timeout),u.pledge}}(XMLHttpRequest),D=function(){function e(e){var t=e.handler;a("preProcess",e),t.onPreProcess&&t.onPreProcess.call(e),t.process&&L.enqueue(e),!U.current&&U.process()}function t(t,n){var r=this,i=S.defer(),o=i.pledge,c=n.handler;return r.deferred=i,r.path=t,r.url=n.url,r.cache=n.cache,r.version=n.version,r.lifetime=n.lifetime,O(W+c).then(function(t){r.handler=t,r.mock=n.mock?ge[r.path]:ce,t.onPreRequest&&t.onPreRequest.call(r),r.mock?r.mock.dependencies?r.mock.dependencies.then(function(){r.mock.resolve(r)},r.mock.reject):r.mock.resolve(r):r.cache!==!1&&X.get(r)?e(r):(a("preRequest",r),new _(r.url).then(function(n,c){c&&t.matchType&&!t.matchType.test(c)?i.reject(new H("error loading (content-type)",r.path)):(r.source=n,a("postRequest",r),t.onPostRequest&&t.onPostRequest.call(r),e(r),r.cache!==!1&&o.then(function(){X.set(r)}))},function(e){i.reject(new H("error loading"+(e?" (status)":""),r.path))}))},i.reject),i}return t}(),H=function(){function e(e,t,n){this.message=e,t&&(this.module=t),n&&(this.stack=B.call(n))}return e.prototype={toString:function(){var t=this,n=J+": "+t.message+" "+(t.module?'"'+t.module+'"':"");return t.stack&&(n=e.traverse(t.stack,n,1)),n}},e.traverse=function(t,n,r){for(var i,o=new Array(r+1).join(" "),c=0;i=t[c];c++)n+="\n"+o+"> "+i.message+" "+(i.module?'"'+i.module+'"':""),i.stack&&(n=e.traverse(i.stack,n,r+1));return n},e}(),O.configure=function(e){var t,n=e.cache,r=e.version,i=e.timeout,o=e.lifetime,c=e.base,u=e.pattern,s=e.modules,f=pe.modules;return w(n,ie)?pe.cache[""]={weight:0,state:n}:b(n)&&P(n,function(e,t){pe.cache[e]={weight:e.length,state:t}}),w(r,re)&&(pe.version=r),R(i)&&(pe.timeout=1e3*Math.min(Math.max(i,2),12)),R(o)&&o>0&&(pe.lifetime=1e3*o),w(c,re)&&""!==c&&(pe.pattern.base=new $("",c)),b(u)&&P(u,function(e,t){"base"!==e&&(pe.pattern[e]=new $(e,t))}),b(s)&&P(s,function(e,n){e!==V&&(t=f[e]=f[e]||{},a("preConfigure:"+e,t),k(t,n),a("postConfigure:"+e,t))}),O},O.remove=function(e){return me[e]&&(!!me[e].cache&&X.clean.path(e),delete me[e],delete ge[e]),O},O.on=function(e,t){var n,r;if(w(e,re)&&w(t,oe))for(e=e.split(" ");n=e.shift();)he.test(n)&&((xe[n]||(xe[n]=[])).push(t),0===n.indexOf("postConfigure:")&&(r=pe.modules[n.substr(14)],r!==u&&t(r)));return O},O.list=function(e){var t,n;return e?(t=[],P(me,function(r,i){n=i.pledge,n.state!==e&&n.cache!==e||t.push(r)})):t=Object.keys(me),t},function(){function t(){function t(e){var t;return e.cache!==ce?e.cache:(P(pe.cache,function(n,r){0===e.path.indexOf(n)&&(!t||r.weight>t.weight)&&(t=r)}),!!t&&t.state)}function n(){this.clear.expired()}var i="["+J+"]",o="[state]",c="[value]",u=h("^"+l(i)+"\\[(.+?)\\]"+l(o)+"$"),s=function(){try{return"localStorage"in e&&e.localStorage}catch(e){return!1}}(),f=s&&"remainingSpace"in s;return n.prototype={exists:function(e){var n,c=e.path;if(e.storage=i+"["+c+"]",s&&t(e)){if(n=r.parse(s.getItem(e.storage+o)),n&&n.version===e.version&&n.url===e.url&&(!n.expires&&!e.lifetime||n.expires>d()))return!0;this.clear.path(c)}},get:function(e){var t=e.deferred.pledge;return this.exists(e)?(t.cache="hit",e.source=s.getItem(e.storage+c),a("cacheHit",e),e.source):(t.cache="miss",void a("cacheMiss",e))},set:function(e){var n,u,l,h=e.path;if(s&&t(e)){a("preCache",e),n=e.lifetime,u=i+"["+h+"]",e.state={version:e.version,expires:n?d()+n:n,url:e.url};try{if(l=f?s.remainingSpace:ce,s.setItem(u+c,e.source),s.setItem(u+o,r.stringify(e.state)),l!==ce&&s.remainingSpace===l)throw new Error("QUOTA_EXCEEDED_ERR");a("postCache",e)}catch(t){a("cacheExceed",e)}}},clear:{path:function(e){var t;s&&(t=i+"["+e+"]",s.removeItem(t+o),s.removeItem(t+c),a("cacheClear",e))},all:function(){var e;s&&P(s,function(t){e=t.match(u),e&&this.path(e[1])},this)},expired:function(){var e,t;s&&P(s,function(n){e=n.match(u),e&&(t=r.parse(s.getItem(i+"["+e[1]+"]"+o)),t&&t.expires>0&&t.expires<=d()&&this.path(e[1]))},this)}}},O.clear=(X=new n).clear,X}C(V,t)}(),function(){function e(){var e=t.getElementsByTagName("head")[0];return{matchType:/^(application|text)\/(x-)?javascript/,onPreRequest:function(){var e=this.url;this.url=".js"!==e.slice(-3)?e+".js":e},onPostRequest:function(){var e,t,n=this,r=n.source;if(r){for(;e=le.exec(r);)ue.test(e[1])?(ve.href=n.url,t=ve.protocol+"//"+ve.host+e[1]):t=p(n.url+"/../"+e[1]),r=r.replace(e[0],"//# sourceMappingURL="+t+".map");n.source=r}},process:function(){var n,r=this.source;r&&(n=t.createElement("script"),n.async=!0,n.text=r,n.setAttribute("demand-path",this.path),e.appendChild(n))}}}C(W+"module",e)}(),function(){function e(e){return O.on("postConfigure:"+n,function(e){t=b(e)?e:{}}),{matchType:e.matchType,onPostRequest:function(){var e,t=this,n=t.source;if(n){for(;e=le.exec(n);)n=n.replace(e[0],"");t.source=n}},onPreProcess:function(){var n=this,r=n.deferred,i=t[n.path];f.apply(ce,i).then(function(){L.enqueue.apply(L,arguments),U.process(),e.process.call(n),O.apply(ce,i).then(r.resolve,function(){r.reject(new H("error resolving",n.path,arguments))})},function(){r.reject(new H("error mocking",ce,arguments))})}}}var t,n=W+"bundle";C(n,["/demand/handler/module"],e)}(),function(){function e(){function e(e){for(var t,n,r=0;t=u[r];r++)0===e.indexOf(t.prefix)&&(!n||t.weight>n.weight)&&(n=t);return n}function n(e){var t,n,r=e.matches,i={pattern:{},modules:{"/demand/handler/bundle":{}}},o=0;for(i.pattern[e.id]=e.fn(r),i.modules["/demand/handler/bundle"][e.id]=t=[];n=r[o];o++)t.push(n.path);return i}function i(e){return me[e]&&me[e].pledge||ge[e]&&ge[e].pledge}function o(){for(var e,t=0;e=this[t];t++)e.deferred.resolve(arguments[t])}function c(){for(var e,t=0;e=this[t];t++)e.deferred.reject(new H("error resolving",e.path))}var u=[];return O.on("postConfigure:"+t,function(e){b(e)&&(u.length=0,P(e,function(e,t){u.push({prefix:e,weight:e.length,fn:t})}))}).on("preResolve",function(t,u){var a,s,l,h,d,p,v={};for(a=0;s=t[a];a++)w(s,re)&&!de.test(s)&&(l=m(s,u),h=g(s,u),h.path=l,h.url=".js"!==h.url.slice(-3)?h.url+".js":h.url,!(d=e(l))||"module"!==h.handler||i(l)||X.exists(h)||(v[d.prefix]||(v[d.prefix]={fn:d.fn,matches:[]})).matches.push({path:l,index:a}));P(v,function(e,i){if(p=i.matches,p.length>1){for(i.id="/genie/"+q(r.stringify(i.matches)),a=0;s=p[a];a++)s.deferred=S.defer(),t[s.index]=s.deferred.pledge,f(s.id);O.configure(n(i)),O("bundle!"+i.id).then(o.bind(p),c.bind(p))}})}),!0}var t=Y+"genie";C(t,e)}(),function(){function t(e,t){C(e,function(){return t})}M=h("^"+l(p("/"))),O.configure({cache:!0,base:"/",pattern:{"/demand":p((n&&n.url||location.href)+"/../").slice(0,-1)}}),n&&n.settings&&O.configure(n.settings),t(ne+"isArray",y),t(ne+"isObject",b),t(ne+"isTypeOf",w),t(ne+"isInstanceOf",j),t(ne+"isPositiveInteger",R),t(te+"merge",k),t(te+"iterate",P),t(te+"hash",q),t(te+"defer",N),t(K+"uuid",T),t(K+"pledge",S),t(K+"queue",I),t(K+"xhr",_),t(K+"failure",H),L=new I,U=new A(L),e.demand=O,e.provide=C,n&&n.main&&O(n.main)}()}(this,document,"demand"in this&&demand,JSON,Array.prototype,Object.prototype,setTimeout);
//# sourceMappingURL=demand.js.map
