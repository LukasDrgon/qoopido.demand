/*! Qoopido.demand 3.5.2 | https://github.com/dlueth/qoopido.demand | (c) 2016 Dirk Lueth */
!function(e,t,n,r,i,o,c,a){"use strict";function s(e){var t,n,r,i=se[e];if(i)for(t=S.call(arguments,1),n=0;r=i[n];n++)r.apply(V,t)}function u(e){k(console,"undefined")||console.error(e.toString())}function f(e,t){C(e,function(){return t})}function l(){for(var e,t,n,r=[],i=0;e=arguments[i];i++)n=e.match(te),e=e.replace(te,""),t=(ae[e]||(ae[e]=fe.defer())).pledge,arguments[i]=(n?"mock:"+n.slice(1).join(""):"mock:")+"!"+e,r.push(t);return q.apply(V,arguments),fe.all(r)}function d(e){return e.replace(ne,"\\$&")}function h(e,t){return new RegExp(e,t)}function p(){return+new Date}function m(e){return oe.href=e,oe.href}function g(e,t){return e=e.replace(te,""),Y.test(e)||Z.test(e)||(e="/"+m((t&&m(t+"/../")||"/")+e).replace(M,"")),e}function v(e,t){var n,r,i;if(k(e,Q)){if(n=g(e,t),t&&(e===_||e===D||e===H)){switch(e){case _:n=B+n,r=function(){var e=q.bind(t);return O(q,function(t,n){e[t]=n}),e};break;case D:n=B+n,r=function(){return C.bind(t)};break;case H:n=F+t,r=function(){return t}}!ce[n]&&C(n,r)}return(ce[n]||(ce[n]=new he(n,x(e,t)))).pledge}return R(e,fe)?e:(i=fe.defer(),i.resolve(e),i.pledge)}function x(e,t){var n,r=e.match(te),i=ie.pattern;return e=g(e,t),Z.test(e)||O(i,function(t,r){r.matches(e)&&(!n||n.weight<r.weight)&&(n=r)}),{mock:!(!r||!r[1]),cache:r&&r[2]?"+"===r[2]:V,handler:r&&r[3]||ie.handler,version:r&&r[4]||ie.version,lifetime:r&&r[5]&&1e3*r[5]||ie.lifetime,url:n?m(n.process(e)):e}}function y(e){var t=e.handler;s("preProcess",e),e.deferred.pledge.isPending()&&(t.onPreProcess&&t.onPreProcess.call(e),t.process&&T.add(e))}function b(e,t){var n,r=this[e];t!==a&&(j(t)?(n=j(r),r=t.length!==a?n&&r.length!==a?r:[]:n&&r.length===a?r:{},this[e]=E(r,t)):this[e]=t)}function w(e){return"[object Array]"===A.call(e)}function j(e){return e&&k(e,"object")}function k(e,t){return typeof e===t}function R(e,t){return e instanceof t}function P(e){return k(e,"number")&&isFinite(e)&&Math.floor(e)===e&&e>=0}function E(){for(var e,t=arguments[0],n=1;(e=arguments[n])!==a;n++)O(e,b,t);return t}function O(e,t,n){for(var r,i=Object.keys(e),o=0;(r=i[o])!==a&&t.call(n,r,e[r])!==!1;o++);}function q(){var e,t=S.call(arguments),n=this!==window?this:V,r=0;for(s("preResolve",t,n);e=t[r];r++)t[r]=v(e,n);return s("postResolve",t,n),fe.all(t)}function C(){var e,t,n,r=arguments,i=k(r[0],Q)?r[0]:V,o=w(r[i?1:0])?r[i?1:0]:V,c=o?r[i?2:1]:r[i?1:0];if(!i&&T.current&&(i=T.current.path,T.current=V,T.items>0&&T.process()),!i)throw new pe("unspecified anonymous provide");i=g(i,this),e=ce[i]||(ce[i]=fe.defer()),t=e.pledge,n=k(c,K),t.isPending()&&(o?q.apply(i,o).then(function(){e.resolve(n?c.apply(V,arguments):c)},function(){u(new pe("error providing "+i))}):e.resolve(n?c():c))}var M,T,I,S=o.slice,A=c.toString,$=o.concat,_="demand",D="provide",H="path",L="/"+_+"/",U=L+"storage/",X=L+"handler/",N=L+"plugin/",B=L+"local",F=L+"paths",G=L+"function/",J=L+"validator/",Q="string",z="boolean",K="function",V=null,W="XDomainRequest"in e&&e.XDomainRequest||i,Y=/^\//,Z=/^(http(s?):)?\/\//i,ee=/(.+)\/$/,te=/^(mock:)?([+-])?((?:[-\w]+\/?)+)?(?:@(\d+\.\d+.\d+))?(?:#(\d+))?!/,ne=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,re=/^cache(Miss|Hit|Clear|Exceed)|(pre|post)(Configure.*|Resolve|Request|Process|Cache)$/,ie={cache:{},timeout:8e3,pattern:{},modules:{},handler:"module"},oe=t.createElement("a"),ce={},ae={},se={},ue=(function(){var n,r,i="setImmediate"in e;return"MutationObserver"in e?function(e){n=t.createElement("div"),new MutationObserver(function(){e()}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:!i&&"postMessage"in e&&"addEventListener"in e?function(){function t(t){t.source===e&&(n=i.exec(t.data))&&(o[n[1]](),delete o[n[1]])}var n,r="com.async",i=new RegExp("^com\\.async\\[([a-f0-9]{8,8}-[a-f0-9]{4,4}-4[a-f0-9]{3,3}-[a-f0-9]{4,4}-[a-f0-9]{12,12})\\]$","g"),o={};return e.addEventListener("message",t,!1),function(t){var n=ue.generate();o[n]=t,e.postMessage(r+"["+n+"]","*")}}():!i&&"onreadystatechange"in(n=t.createElement("script"))?function(e){n.onreadystatechange=function(){n.onreadystatechange=V,n.parentNode.removeChild(n),e()},t.body.appendChild(n)}:(r=i?setImmediate:setTimeout,function(e){r(e)})}(),function(){function e(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}function t(){}var n=Object.defineProperty,r=new RegExp("[xy]","g"),i={};return t.prototype={generate:function(){var t;do t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(r,e);while(i[t]);return i[t]=1,t},set:function(e){return"undefined"==typeof e.uuid&&n(e,"uuid",{__proto__:V,value:this.generate(),enumerable:!1,configurable:!1,writable:!1}),e.uuid}},new t}()),fe=function(){function e(){u[this.uuid].handle(a,arguments)}function t(){u[this.uuid].handle(s,arguments)}function n(e,t){var n,r,i=this,o=u[i.uuid];for(i.state===c&&(i.state=e,i.value=t);n=o[i.state].shift();)r=n.handler.apply(V,i.value),r&&"function"==typeof r.then?r.then(n.deferred.resolve,n.deferred.reject):n.deferred[i.state===a?"resolve":"reject"].apply(V,i.value);o[a].length=0,o[s].length=0}function r(e,t,n){e.then(function(){n.resolved[t]=S.call(arguments),n.count++,i(n)},function(){n.rejected.push(S.call(arguments)),i(n)})}function i(e){e.count===e.total?e.deferred.resolve.apply(V,$.apply([],e.resolved)):e.rejected.length+e.count===e.total&&e.deferred.reject.apply(V,$.apply([],e.rejected))}function o(r){var i=this;u[ue.set(i)]={handle:n.bind(i),resolved:[],rejected:[]},r(e.bind(i),t.bind(i))}var c="pending",a="resolved",s="rejected",u={};return o.prototype={state:c,always:function(e){return this.then(e,e)},then:function(e,t){var n=this,r=u[n.uuid],i=o.defer();return e&&r[a].push({handler:e,deferred:i}),t&&r[s].push({handler:t,deferred:i}),n.state!==c&&r.handle(),i.pledge},isPending:function(){return this.state===c},isResolved:function(){return this.state===a},isRejected:function(){return this.state===s}},o.defer=function(){var e={};return e.pledge=new o(function(t,n){e.resolve=t,e.reject=n}),e},o.all=function(e){for(var t,n=o.defer(),i=u[ue.generate()]={deferred:n,resolved:[],rejected:[],total:e.length,count:0},c=0;t=e[c];c++)r(t,c,i);return n.pledge},o.race=function(e){for(var t,n=o.defer(),r=0;t=e[r];r++)t.then(n.resolve,n.reject);return n.pledge},o}(),le=function(){function t(){ue.set(this),e.stack=n[this.uuid]={stack:[],current:V}}var n={};return t.prototype={add:function(){var e=n[this.uuid];e.stack=e.stack.concat(S.call(arguments)),!e.current&&this.process()},process:function(){var e,t=n[this.uuid];t.stack.length&&(e=t.current=t.stack.shift(),e.handler.process.call(e),s("postProcess",e))},get current(){return n[this.uuid].current},set current(e){console.log("hier",e),n[this.uuid].current=e},get items(){return n[this.uuid].stack.length}},t}(),de=function(){function e(e,t){var n=this;n.weight=e.length,n.url=m(t).replace(ee,"$1"),n.matchPattern=h("^"+d(e)),n.matchUrl=h("^"+d(t))}return e.prototype={matches:function(e){return this.matchPattern.test(e)},remove:function(e){return e.replace(this.matchUrl,"")},process:function(e){return e.replace(this.matchPattern,this.url)}},e}(),he=function(){function e(e,t){var n,r,o=this,c=fe.defer(),a=c.pledge,u=t.handler;return o.deferred=c,o.path=e,o.url=t.url,o.cache=t.cache,o.version=t.version,o.lifetime=t.lifetime,q(X+u).then(function(e){o.handler=e,o.mock=t.mock?ae[o.path]:V,e.onPreRequest&&e.onPreRequest.call(o),o.mock?o.mock.dependencies?o.mock.dependencies.then(function(){o.mock.resolve(o)},o.mock.reject):o.mock.resolve(o):o.cache!==!1&&I.get(o)?y(o):(s("preRequest",o),a.isPending()&&(n=M.test(o.url)?new i:new W,n.onprogress=function(){},n.ontimeout=n.onerror=n.onabort=function(){c.reject(new pe("timeout requesting",o.path))},n.onload=function(){var t=n.getResponseHeader&&n.getResponseHeader("content-type");r=clearTimeout(r),"status"in n&&200!==n.status||t&&e.matchType&&!e.matchType.test(t)?c.reject(new pe("error requesting",o.path)):(o.source=n.responseText,s("postRequest",o),a.isPending()&&(e.onPostRequest&&e.onPostRequest.call(o),y(o),o.cache!==!1&&a.then(function(){I.set(o)})))},n.open("GET",o.url,!0),n.send(),r=setTimeout(function(){n.readyState<4&&n.abort()},ie.timeout)))},c.reject),c}return e}(),pe=function(){function e(e,t,n){this.message=e,t&&(this.module=t),n&&(this.stack=S.call(n))}return e.prototype={toString:function(){var t=this,n=_+": "+t.message+" "+(t.module?'"'+t.module+'"':"");return t.stack&&(n=e.traverse(t.stack,n,1)),n}},e.traverse=function(t,n,r){for(var i,o=new Array(r+1).join(" "),c=0;i=t[c];c++)n+="\n"+o+"> "+i.message+" "+(i.module?'"'+i.module+'"':""),i.stack&&(n=e.traverse(i.stack,n,r+1));return n},e}();q.configure=function(e){var t,n=e.cache,r=e.version,i=e.timeout,o=e.lifetime,c=e.base,a=e.pattern,u=e.modules,f=ie.modules;return k(n,z)?ie.cache[""]={weight:0,state:n}:j(n)&&O(n,function(e,t){ie.cache[e]={weight:e.length,state:t}}),k(r,Q)&&(ie.version=r),P(i)&&(ie.timeout=1e3*Math.min(Math.max(i,2),12)),P(o)&&o>0&&(ie.lifetime=1e3*o),k(c,Q)&&""!==c&&(ie.pattern.base=new de("",c)),j(a)&&O(a,function(e,t){"base"!==e&&(ie.pattern[e]=new de(e,t))}),j(u)&&O(u,function(e,n){e!==U&&(t=f[e]=f[e]||{},s("preConfigure:"+e,t),E(t,n),s("postConfigure:"+e,t))}),q},q.remove=function(e){return ce[e]&&(!!ce[e].cache&&I.clean.path(e),delete ce[e],delete ae[e]),q},q.on=function(e,t){var n,r;if(k(e,Q)&&k(t,K))for(e=e.split(" ");n=e.shift();)re.test(n)&&((se[n]||(se[n]=[])).push(t),0===n.indexOf("postConfigure:")&&(r=ie.modules[n.substr(14)],r!==a&&t(r)));return q},q.list=function(e){var t,n;return e?(t=[],O(ce,function(r,i){n=i.pledge,n.state!==e&&n.cache!==e||t.push(r)})):t=Object.keys(ce),t},function(){function t(){function t(e){var t;return e.cache!==V?e.cache:(O(ie.cache,function(n,r){0===e.path.indexOf(n)&&(!t||r.weight>t.weight)&&(t=r)}),!!t&&t.state)}function n(){this.clear.expired()}var i="["+_+"]",o="[state]",c="[value]",a=h("^"+d(i)+"\\[(.+?)\\]"+d(o)+"$"),u=function(){try{return"localStorage"in e&&e.localStorage}catch(e){return!1}}(),f=u&&"remainingSpace"in u;return n.prototype={get:function(e){var n,a,f,l=e.path;if(u&&t(e)){if(n=i+"["+l+"]",a=r.parse(u.getItem(n+o)),f=e.deferred.pledge,a&&a.version===e.version&&a.url===e.url&&(!a.expires&&!e.lifetime||a.expires>p()))return f.cache="hit",e.source=u.getItem(n+c),s("cacheHit",e),e.source;f.cache="miss",s("cacheMiss",e),this.clear.path(l)}},set:function(e){var n,a,l,d=e.path;if(u&&t(e)){s("preCache",e),n=e.lifetime,a=i+"["+d+"]",e.state={version:e.version,expires:n?p()+n:n,url:e.url};try{if(l=f?u.remainingSpace:V,u.setItem(a+c,e.source),u.setItem(a+o,r.stringify(e.state)),l!==V&&u.remainingSpace===l)throw new Error("QUOTA_EXCEEDED_ERR");s("postCache",e)}catch(t){s("cacheExceed",e)}}},clear:{path:function(e){var t;u&&(t=i+"["+e+"]",u.removeItem(t+o),u.removeItem(t+c),s("cacheClear",e))},all:function(){var e;u&&O(u,function(t){e=t.match(a),e&&this.path(e[1])},this)},expired:function(){var e,t;u&&O(u,function(n){e=n.match(a),e&&(t=r.parse(u.getItem(i+"["+e[1]+"]"+o)),t&&t.expires>0&&t.expires<=p()&&this.path(e[1]))},this)}}},q.clear=(I=new n).clear,I}C(U,t)}(),function(){function e(){var e=t.getElementsByTagName("head")[0],n=/\/\/#\s+sourceMappingURL\s*=\s*(?!(?:http[s]?:)?\/\/)(.+?)\.map/g;return{matchType:/^(application|text)\/(x-)?javascript/,onPreRequest:function(){var e=this.url;this.url=".js"!==e.slice(-3)?e+".js":e},onPostRequest:function(){var e,t,r=this,i=r.source;if(i){for(;e=n.exec(i);)Y.test(e[1])?(oe.href=r.url,t=oe.protocol+"//"+oe.host+e[1]):t=m(r.url+"/../"+e[1]),i=i.replace(e[0],"//# sourceMappingURL="+t+".map");r.source=i}},process:function(){var n,r=this.source;r&&(n=t.createElement("script"),n.async=!0,n.text=r,n.setAttribute("demand-path",this.path),e.appendChild(n))}}}C(X+"module",e)}(),function(){function e(e){function r(e){t=j(e)?e:{}}return q.on("postConfigure:"+n,r),{matchType:e.matchType,onPostRequest:e.onPostRequest,onPreProcess:function(){var n=this,r=n.deferred,i=t[n.path];l.apply(V,i).then(function(){T.add.apply(T,arguments),e.process.call(n),q.apply(V,i).then(r.resolve,function(){r.reject(new pe("error resolving",n.path,arguments))})},function(){r.reject(new pe("error mocking",V,arguments))})}}}var t,n=X+"bundle";C(n,["/demand/handler/module"],e)}(),function(){function e(){function e(e){j(e)&&(u.length=0,O(e,function(e,t){u.push({prefix:e,weight:e.length,fn:t})}))}function n(e){for(var t,n,r=0;t=u[r];r++)0===e.indexOf(t.prefix)&&(!n||t.weight>n.weight)&&(n=t);return n}function i(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}function o(e){var t,n,r=e.matches,i={pattern:{},modules:{"/demand/handler/bundle":{}}},o=0;for(i.pattern[e.id]=e.fn(r),i.modules["/demand/handler/bundle"][e.id]=t=[];n=r[o];o++)t.push(n.id);return i}function c(e){return ce[e]&&ce[e].pledge||ae[e]&&ae[e].pledge}function a(){for(var e,t=0;e=this[t];t++)e.dfd.resolve(arguments[t])}function s(){for(var e,t=0;e=this[t];t++)e.dfd.reject(new pe("error resolving",e.path))}var u=[];return q.on("postConfigure:"+t,e),q.on("preResolve",function(e,t){var u,f,d,h,p,m,v={};for(u=0;f=e[u];u++)k(f,"string")&&(d=g(f,t),!c(d)&&(h=x(f,t))&&"module"===h.handler&&(p=n(d))&&(v[p.prefix]||(v[p.prefix]={fn:p.fn,matches:[]})).matches.push({id:d,path:f,index:u,dfd:V}));O(v,function(t,n){if(m=n.matches,m.length>1){for(n.id="/genie/"+i(r.stringify(n.matches)),u=0;f=m[u];u++)f.dfd=fe.defer(),e[f.index]=f.dfd.pledge,l(f.id);q.configure(o(n)),q("bundle!"+n.id).then(a.bind(m),s.bind(m))}})}),!0}var t=N+"genie";C(t,e)}(),M=h("^"+d(m("/"))),q.configure({cache:!0,base:"/",pattern:{"/demand":m((n&&n.url||location.href)+"/../").slice(0,-1)}}),n&&n.settings&&q.configure(n.settings),f(J+"isArray",w),f(J+"isObject",j),f(J+"isTypeOf",k),f(J+"isInstanceOf",R),f(J+"isPositiveInteger",P),f(G+"merge",E),f(G+"iterate",O),f(L+"pledge",fe),f(L+"failure",pe),T=new le,e.demand=q,e.provide=C,n&&n.main&&q(n.main)}(this,document,"demand"in this&&demand,JSON,XMLHttpRequest,Array.prototype,Object.prototype);
//# sourceMappingURL=demand.js.map
